clear all;
clc;

%Input n, thickness values, and wavelengths
NAir = 1.0003;
NGrDat = [2.71628300000000 - 1.39670800000000i,2.71148000000000 - 1.38498800000000i,2.70778400000000 - 1.37571500000000i,2.70495700000000 - 1.36856100000000i,2.70284000000000 - 1.36326900000000i,2.70132700000000 - 1.35963300000000i,2.70034400000000 - 1.35747800000000i,2.69984400000000 - 1.35665400000000i,2.69979000000000 - 1.35702600000000i,2.70015500000000 - 1.35847500000000i,2.70091900000000 - 1.36089700000000i,2.70206300000000 - 1.36419300000000i,2.70357200000000 - 1.36827900000000i,2.70543100000000 - 1.37307500000000i,2.70762600000000 - 1.37851200000000i,2.71014500000000 - 1.38452600000000i,2.71297300000000 - 1.39105900000000i,2.71609900000000 - 1.39805800000000i,2.71951000000000 - 1.40547700000000i,2.72319300000000 - 1.41327300000000i,2.72713700000000 - 1.42140800000000i,2.73133000000000 - 1.42984700000000i,2.73576100000000 - 1.43855700000000i,2.74041900000000 - 1.44751100000000i,2.74529300000000 - 1.45668200000000i,2.75037300000000 - 1.46604700000000i,2.75564900000000 - 1.47558400000000i,2.76111300000000 - 1.48527400000000i,2.76675400000000 - 1.49509900000000i,2.77256400000000 - 1.50504400000000i,2.77853500000000 - 1.51509200000000i,2.78465900000000 - 1.52523200000000i,2.79092900000000 - 1.53545200000000i,2.79733700000000 - 1.54573900000000i,2.80387600000000 - 1.55608400000000i,2.81054100000000 - 1.56647800000000i];
NSiO2Dat = [1.47569400000000,1.47462800000000,1.47363900000000,1.47272100000000,1.47186700000000,1.47106900000000,1.47032400000000,1.46962500000000,1.46896900000000,1.46835200000000,1.46777100000000,1.46722200000000,1.46670400000000,1.46621200000000,1.46574600000000,1.46530400000000,1.46488300000000,1.46448200000000,1.46409900000000,1.46373300000000,1.46338300000000,1.46304800000000,1.46272700000000,1.46241800000000,1.46212100000000,1.46183500000000,1.46156000000000,1.46129400000000,1.46103700000000,1.46078900000000,1.46054700000000,1.46031400000000,1.46008900000000,1.45986800000000,1.45965500000000,1.45944700000000];
NSiDat = [5.63171600000000 - 0.285821300000000i,5.34655700000000 - 0.212582900000000i,5.13419000000000 - 0.160634600000000i,4.96260500000000 - 0.122018700000000i,4.81913900000000 - 0.0939212600000000i,4.69728900000000 - 0.0739159300000000i,4.59272700000000 - 0.0598907000000000i,4.50238500000000 - 0.0501741100000000i,4.42391700000000 - 0.0434724500000000i,4.35528000000000 - 0.0387762600000000i,4.29492700000000 - 0.0353747500000000i,4.24152700000000 - 0.0327590300000000i,4.19392100000000 - 0.0305925000000000i,4.15113400000000 - 0.0286754500000000i,4.11249400000000 - 0.0269094600000000i,4.07732400000000 - 0.0252482700000000i,4.04518300000000 - 0.0236772700000000i,4.01567700000000 - 0.0221908900000000i,3.98847100000000 - 0.0207852600000000i,3.96331000000000 - 0.0194575300000000i,3.93996900000000 - 0.0182043800000000i,3.91824200000000 - 0.0170216300000000i,3.89796000000000 - 0.0159055000000000i,3.87901700000000 - 0.0148545100000000i,3.86126100000000 - 0.0138637700000000i,3.84458500000000 - 0.0129302700000000i,3.82889500000000 - 0.0120509300000000i,3.81411400000000 - 0.0112231900000000i,3.80017700000000 - 0.0104448400000000i,3.78699700000000 - 0.00971188900000000i,3.77452000000000 - 0.00902226300000000i,3.76270800000000 - 0.00837446500000000i,3.75149300000000 - 0.00776502500000000i,3.74084000000000 - 0.00719237600000000i,3.73072000000000 - 0.00665514400000000i,3.72107900000000 - 0.00615027000000000i];

GrThick = 3.37*10^-10;
SiO2Thick = linspace(0,350e-9,176);

wavelengths = linspace(400e-9,750e-9,36);
polyGrReal = polyfit(wavelengths,real(NGrDat),7);
polyGrImag = polyfit(wavelengths,imag(NGrDat),7);
polySiO2 = polyfit(wavelengths,NSiO2Dat,7);
polySiReal = polyfit(wavelengths,real(NSiDat),7);
polySiImag = polyfit(wavelengths,imag(NSiDat),7);

wavelengths = linspace(400e-9,750e-9,176);
NGrReal = polyval(polyGrReal, wavelengths);
NGrImag = polyval(polyGrImag, wavelengths);
NGr = NGrReal+1i*NGrImag;
NSiO2 = polyval(polySiO2, wavelengths);
NSiReal = polyval(polySiReal, wavelengths);
NSiImag = polyval(polySiImag, wavelengths);
NSi = NSiReal+1i*NSiImag;

% figure;
% plot(real(NGr));
% hold on;
% plot(linspace(0,35,36)*175/35+1, real(NGrDat), 'color', 'red');
% figure;
% plot(imag(NGr));
% hold on;
% plot(linspace(0,35,36)*175/35+1, imag(NGrDat), 'color', 'red');

%Compute beta values
bGr = zeros(1,176);
bSiO2 = zeros(176,176);
for a = 1:176   
    for b = 1:176
        bGr(a) = (2*pi*GrThick*NGr(a))/wavelengths(a);
        bSiO2(a,b) = (2*pi*SiO2Thick(b)*NSiO2(a))/wavelengths(a);       
    end   
end

%Compute 2 layer r values (p polarized)
rAirGr = zeros(1,176);
rSiO2Si = zeros(1,176);
rAirSiO2 = zeros(1,176);
rGrSiO2 = zeros(1,176);
for a = 1:176
    rAirGr(a) = (NGr(a)-NAir)/(NGr(a)+NAir);
    rAirSiO2(a) = (NSiO2(a)-NAir)/(NSiO2(a)+NAir);
    rGrSiO2(a) = (NSiO2(a)-NGr(a))/(NSiO2(a)+NGr(a));
    rSiO2Si(a) = (NSi(a)-NSiO2(a))/(NSi(a)+NSiO2(a));
end


%Compute 3 layer r values (p polarized)
rAirSiO2Si = zeros(176,176);
rGrSiO2Si = zeros(176,176);
for a = 1:176
    for b = 1:176
        rAirSiO2Si(a,b) = (rAirSiO2(a)+(rSiO2Si(a)*exp(-2i*bSiO2(a,b))))/(1+rAirSiO2(a)*(rSiO2Si(a)*exp(-2i*bSiO2(a,b))));
        rGrSiO2Si(a,b) = (rGrSiO2(a)+(rSiO2Si(a)*exp(-2i*bSiO2(a,b))))/(1+rGrSiO2(a)*(rSiO2Si(a)*exp(-2i*bSiO2(a,b))));
        
    end
end


%Compute 4 layer r value (p polarized)
rAirGrSiO2Si = zeros(176,176);
for a = 1:176  
    for b = 1:176    
        rAirGrSiO2Si(a,b) = (rAirGr(a)+rGrSiO2Si(a,b)*exp(-2i*bGr(a)))/(1+rAirGr(a)*rGrSiO2Si(a,b)*exp(-2i*bGr(a)));       
    end    
end


%Compute R values
RAirGrSiO2Si = zeros(176,176);
RAirSiO2Si = zeros(176,176);
for a = 1:176    
    for b = 1:176        
        RAirGrSiO2Si(a,b) = rAirGrSiO2Si(a,b)*conj(rAirGrSiO2Si(a,b));  
        RAirSiO2Si(a,b) = rAirSiO2Si(a,b)*conj(rAirSiO2Si(a,b ));  
    end    
end


%Compute the comparison R value
RCompare = zeros(176,176);
for a = 1:176  
    for b = 1:176       
        RCompare(a,b) = (RAirGrSiO2Si(a,b)-RAirSiO2Si(a,b))/RAirSiO2Si(a,b);       
    end   
end

%Get something Plottable
for a = 1:176  
    for b = 1:176       
        if RCompare(a,b) > 3
            RCompare(a,b) = 3;
        end
    end   
end

%Create a mesh plot
figure;
mesh(SiO2Thick(1:176)*10^9,wavelengths*10^9,RCompare)
xlabel('Oxide Thickness (nm)');
ylabel('Wavelength (nm)');
zlabel('Relative Reflected Intensity Difference');
view(2);
colorbar;
